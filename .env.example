# GDELT Cloud MCP Server Configuration
# Copy this file to .env and fill in your values

# ==============================================================================
# REQUIRED: Supabase OAuth Configuration (Identity Provider)
# ==============================================================================

# Your Supabase project URL - used for OAuth authentication
# This is the identity provider that authenticates users
# 
# Production (Supabase Cloud):
SUPABASE_URL=https://your-project-ref.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY
# 
# Local development:
# SUPABASE_URL=http://127.0.0.1:54321
#
# OAuth endpoints auto-discovered at:
# - Discovery: /.well-known/oauth-authorization-server/auth/v1
# - Authorization: /auth/v1/authorize
# - Token: /auth/v1/token
# - Registration: /auth/v1/register (Dynamic Client Registration enabled)
# - JWKS: /auth/v1/jwks (for token verification)

# ==============================================================================
# REQUIRED: MCP Server Base URL (This Server)
# ==============================================================================

# The base URL where THIS MCP server is accessible
# This identifies YOUR MCP server as the protected resource in OAuth flows
# MCP clients use this for OAuth discovery metadata
#
# Local development (FastMCP assigns port dynamically):
MCP_SERVER_BASE_URL=http://localhost
#
# Production (your deployed MCP server):
# MCP_SERVER_BASE_URL=https://mcp.yourcompany.com
#
# IMPORTANT: This is different from GDELT_CLOUD_API_URL below
# - MCP_SERVER_BASE_URL = Where THIS MCP server runs
# - GDELT_CLOUD_API_URL = Backend API that this server calls

# ==============================================================================
# REQUIRED: GDELT Cloud API Endpoint (Backend API)
# ==============================================================================

# The Next.js API that this MCP server calls to execute queries
# This is the backend service with ClickHouse access
#
# Production:
GDELT_CLOUD_API_URL=https://your-domain.com
# 
# Local development:
# GDELT_CLOUD_API_URL=http://localhost:3000

# ==============================================================================
# ARCHITECTURE OVERVIEW
# ==============================================================================

# Authentication Flow:
# 1. MCP Client discovers OAuth via MCP_SERVER_BASE_URL/.well-known/oauth-protected-resource
# 2. Client authenticates with Supabase (NEXT_PUBLIC_SUPABASE_URL)
# 3. Client receives JWT access token from Supabase
# 4. Client sends requests to MCP server with Bearer token
# 5. MCP server verifies token against Supabase JWKS
# 6. MCP server forwards authenticated requests to GDELT_CLOUD_API_URL
# 7. GDELT API validates token and executes query
# 8. Results returned through MCP server to client

# What This Server Does:
# - Provides MCP tool/resource interface for GDELT data
# - Handles OAuth discovery for MCP clients
# - Verifies JWT tokens from Supabase
# - Forwards authenticated requests to GDELT Cloud API
# - Returns query results to MCP clients

# What This Server Does NOT Need:
# - API keys (clients provide these via Bearer token)
# - Database credentials (API handles that)
# - Manual OAuth client registration (uses Dynamic Client Registration)

# Dual Authentication Support:
# - OAuth 2.1 with DCR: For interactive users via Supabase
# - API Keys (gdelt_sk_*): For developers and automated agents
# Both authentication methods work through the same Bearer token mechanism

# ==============================================================================
# DEPLOYMENT NOTES
# ==============================================================================

# Production Deployment:
# 1. Set NEXT_PUBLIC_SUPABASE_URL to your Supabase project
# 2. Set MCP_SERVER_BASE_URL to your deployed MCP server URL
# 3. Set GDELT_CLOUD_API_URL to your deployed GDELT Cloud instance
# 4. Ensure Supabase OAuth is enabled with Dynamic Client Registration
# 5. Configure allowed redirect URIs in Supabase dashboard

# Local Development:
# 1. Keep MCP_SERVER_BASE_URL=http://localhost (default)
# 2. Set GDELT_CLOUD_API_URL=http://localhost:3000
# 3. Use local Supabase or cloud Supabase project
# 4. Test with API keys from local/cloud instance
# 5. Run: uv run fastmcp dev server.py

# Security:
# - Tokens verified using Supabase public keys (JWKS)
# - Row Level Security policies apply automatically
# - Redirect URIs validated during OAuth flow
# - API rate limiting handled by GDELT Cloud API
